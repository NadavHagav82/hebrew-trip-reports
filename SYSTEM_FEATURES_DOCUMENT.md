# 📋 מסמך פיצ'רים מלא - מערכת ניהול הוצאות ונסיעות

## 🏢 סקירה כללית
מערכת מקיפה לניהול הוצאות נסיעות עסקיות, אישור בקשות נסיעה, מעקב תקציבים ודיווח הוצאות.
המערכת תומכת במספר סוגי משתמשים עם הרשאות שונות.

---

## 👥 סוגי משתמשים ותפקידים

### 1. עובד רגיל (Employee)
- יצירת דוחות הוצאות
- הגשת בקשות נסיעה
- צפייה בהיסטוריית הדוחות שלו
- עדכון פרופיל אישי

### 2. מנהל (Manager)
- כל הרשאות עובד רגיל
- צפייה בסטטיסטיקות הצוות
- אישור/דחייה של דוחות הוצאות מהצוות
- אישור/דחייה של בקשות נסיעה
- צפייה בדוחות מתקדמים

### 3. מנהל הנהלת חשבונות (Accounting Manager)
- ניהול כל הדוחות בארגון
- סטטיסטיקות ארגוניות
- ניהול משתמשים
- אנליטיקות AI
- ניהול תבניות הוצאות
- סיכום החזרים

### 4. מנהל ארגון (Org Admin)
- ניהול קודי הזמנה לעובדים
- ניהול משתמשי הארגון
- הגדרת מדיניות נסיעות
- אנליטיקות ארגון

### 5. מנהל מערכת (Admin)
- ניהול כל הארגונים
- ניהול תפקידים
- ניהול משתמשים ברמת המערכת
- גישה מלאה לכל הנתונים

---

## 📄 מודול דוחות הוצאות (Expense Reports)

### יצירת דוח חדש (`/reports/new`)
- **פרטי נסיעה:**
  - יעד הנסיעה
  - תאריך התחלה וסיום
  - מטרת הנסיעה
  - הערות

- **קצבת יומית (Daily Allowance):**
  - חישוב אוטומטי לפי מדינה ($100 או $125)
  - אפשרות לקצבה מלאה / מותאמת אישית / ללא קצבה

- **ניהול הוצאות:**
  - הוספת הוצאות לפי קטגוריות:
    - ✈️ טיסות
    - 🏨 לינה / חדרי ישיבות
    - 🍽️ אוכל ואירוח
    - 🚗 תחבורה מקומית
    - 📦 שונות
  - תמיכה ב-50+ מטבעות שונים
  - המרה אוטומטית לשקלים (שערי חליפין חיים)
  - צירוף קבלות (תמונות/PDF)

- **זיהוי קבלות חכם (AI):**
  - סריקת קבלות אוטומטית
  - חילוץ סכום, תאריך וקטגוריה
  - תמיכה בהמרת PDF לתמונות

- **שמירה אוטומטית:**
  - שמירת טיוטה אוטומטית
  - אין צורך ללחוץ "שמור"

- **זיהוי כפילויות:**
  - התראה על הוצאות דומות/כפולות

### צפייה בדוח (`/reports/:id`)
- תצוגת כל פרטי הדוח
- סטטוס הדוח (טיוטה/פתוח/ממתין לאישור/סגור)
- היסטוריית תגובות הנהלת חשבונות
- ייצוא ל-PDF

### אישור דוחות (`/approve-report/:token`)
- קישור ייחודי למנהל לאישור
- אישור/דחייה עם הערות

---

## ✈️ מודול בקשות נסיעה (Travel Requests)

### רשימת בקשות (`/travel-requests`)
- צפייה בכל הבקשות שלי
- סינון לפי סטטוס
- חיפוש

### יצירת בקשת נסיעה (`/travel-requests/new`)
- **פרטי הנסיעה:**
  - עיר ומדינת יעד
  - תאריכי התחלה וסיום
  - מטרת הנסיעה
  - פרטים נוספים

- **אומדן עלויות:**
  - הערכת עלות טיסות
  - עלות לינה לילה
  - עלות ארוחות ליום
  - תחבורה
  - הוצאות אחרות
  - **חישוב אוטומטי של סה"כ**

- **בדיקת מדיניות:**
  - התראה על חריגות ממדיניות
  - דרישת הסברים לחריגות

- **שרשרת אישורים:**
  - אישור מנהל ישיר
  - שרשראות אישורים מותאמות (עד רמות מרובות)
  - דילוג על רמות לפי תקציב

- **צירוף מסמכים:**
  - אפשרות להעלות קבצים תומכים

### פרטי בקשה (`/travel-requests/:id`)
- צפייה בכל הפרטים
- סטטוס אישורים
- היסטוריית אישורים

### אישור בקשות (`/travel-requests/pending`)
- רשימת בקשות ממתינות לאישור
- אישור/דחייה עם הערות

### היסטוריית אישורים (`/travel/my-approval-history`)
- כל הבקשות שאישרתי/דחיתי

### נסיעות מאושרות (`/approved-travels`)
- רשימת כל הנסיעות המאושרות

---

## 📊 מודול מנהל (Manager)

### דשבורד מנהל (`/manager/dashboard`)
- סיכום הצוות
- בקשות ממתינות לאישור
- סטטיסטיקות מהירות

### הצוות שלי (`/manager/team`)
- רשימת עובדי הצוות
- סטטוס כל עובד

### סטטיסטיקות צוות (`/manager/stats`)
- הוצאות הצוות
- ניתוח לפי קטגוריות
- מגמות

### סטטיסטיקות אישיות (`/manager/personal-stats`)
- ההוצאות האישיות של המנהל

### סטטיסטיקות נסיעות (`/manager/travel-stats`)
- ניתוח בקשות נסיעה

### דוחות מתקדמים (`/manager/advanced-reports`)
- דוחות מותאמים אישית
- ייצוא נתונים

---

## 💼 מודול הנהלת חשבונות (Accounting)

### בית (`/accounting/home`)
- דשבורד מהיר
- גישה לכל הכלים

### דשבורד (`/accounting/dashboard`)
- סקירה כללית
- דוחות ממתינים לטיפול

### סטטיסטיקות (`/accounting/stats`)
- ניתוח הוצאות ארגוני
- גרפים ותרשימים

### אנליטיקות ארגוניות (`/accounting/organizational-analytics`)
- ניתוח מעמיק ברמת הארגון
- השוואות בין מחלקות

### סיכום החזרים (`/accounting/reimbursements`)
- ניהול החזרים לעובדים
- מעקב תשלומים

### ניהול משתמשים (`/accounting/users`)
- צפייה ועריכת משתמשים
- שינוי הרשאות

### תבניות הוצאות (`/accounting/templates`)
- יצירת תבניות הוצאות נפוצות
- חיסכון בזמן מילוי דוחות

### אנליטיקות AI (`/accounting/ai-analytics`)
- ניתוח דיוק זיהוי קבלות
- שיפור מודלים

### ניהול Bootstrap Tokens (`/accounting/bootstrap-tokens`)
- יצירת קודים להרשמה ראשונית

---

## 🏛️ מודול מנהל ארגון (Org Admin)

### דשבורד (`/orgadmin`)
- סקירת הארגון
- גישה מהירה לכלים

### קודי הזמנה (`/orgadmin/invitation-codes`)
- יצירת קודי הזמנה לעובדים חדשים
- ניהול קודים קיימים
- הגדרת תוקף

### ניהול משתמשים (`/orgadmin/users`)
- צפייה בכל משתמשי הארגון
- שינוי הרשאות
- הקצאת מנהלים

### אנליטיקות ארגון (`/orgadmin/analytics`)
- דוחות ברמת הארגון
- מגמות הוצאות

### בניית מדיניות נסיעות (`/orgadmin/travel-policy`)
מודול מקיף להגדרת מדיניות הארגון:

#### 📋 דשבורד מדיניות
- סקירת מצב ההגדרות
- אחוז השלמה
- עדכון אחרון

#### 👥 דרגות עובדים
- יצירת דרגות (ג'וניור, סניור, מנהל...)
- הקצאת תקציבים לפי דרגה

#### 🔗 שרשראות אישורים
- הגדרת מי מאשר מה
- סדר אישורים
- דילוג על רמות לפי סכום

#### ✈️ חוקי קטגוריות
- תקרות עלות לטיסות
- תקרות למלונות (ללילה)
- תקרות לארוחות (ליום)
- תקרות תחבורה

#### 🚫 הגבלות
- מדינות אסורות לנסיעה
- חברות תעופה מועדפות/אסורות
- רשתות מלונות מאושרות

#### ⭐ חוקים מותאמים אישית
- כללים ייחודיים לארגון
- תנאים מורכבים

#### 👁️ תצוגה מקדימה
- צפייה במדיניות המלאה
- איך העובדים יראו אותה

#### 📜 יומן שינויים
- מעקב אחר כל השינויים
- מי שינה ומתי

---

## 🔐 מודול אימות (Authentication)

### התחברות (`/auth/login`)
- כניסה עם אימייל וסיסמה
- שכחתי סיסמה
- בדיקת חיבור לשרת

### הרשמה (`/auth/register`)
- בחירת סוג משתמש:
  - עובד
  - מנהל
  - עצמאי

### הרשמה עם קוד (`/auth/register/code`)
- הרשמה עם קוד הזמנה מהארגון

### הרשמת עובד (`/auth/register/employee`)
- שם מלא
- אימייל
- סיסמה
- מחלקה
- בחירת מנהל

### הרשמת מנהל (`/auth/register/manager`)
- פרטי המנהל
- הקמת צוות

### הרשמה ראשונית (`/auth/register/bootstrap`)
- הקמת ארגון חדש
- משתמש ראשון

### שחזור סיסמה (`/auth/forgot-password`)
- שליחת קישור לאיפוס

### איפוס סיסמה (`/auth/reset-password`)
- הגדרת סיסמה חדשה

---

## 👤 פרופיל משתמש

### עריכת פרופיל
- שם מלא
- מחלקה
- אימייל מנהל הנהלת חשבונות
- בחירת מנהל ישיר

### שינוי סיסמה
- סיסמה נוכחית
- סיסמה חדשה
- אימות חוזק סיסמה

### שינוי אימייל
- אימות סיסמה
- אימייל חדש
- שליחת אישור

---

## 🔔 התראות

### פעמון התראות
- התראות בזמן אמת
- סימון כנקרא

### סוגי התראות:
- דוח חדש לאישור
- דוח אושר/נדחה
- בקשת נסיעה חדשה
- בקשת נסיעה אושרה/נדחתה
- תגובה מהנהלת חשבונות
- עובד חדש הצטרף

---

## 📧 מערכת דוא"ל

### Edge Functions לשליחת מיילים:
- `send-report-email` - שליחת דוח
- `send-accounting-report` - שליחת דוח להנהלת חשבונות
- `send-invitation-email` - שליחת הזמנה
- `notify-accounting-comment` - התראה על תגובה
- `notify-approval-skipped` - התראה על דילוג אישור
- `notify-employee-review` - התראה לעובד על סקירה
- `notify-manager-new-employee` - התראה למנהל על עובד חדש
- `notify-missing-grades` - התראה על דרגות חסרות
- `notify-travel-decision` - התראה על החלטה בנסיעה
- `notify-travel-request` - התראה על בקשת נסיעה

---

## 🤖 פונקציות AI

### ניתוח קבלות (`analyze-receipt`)
- זיהוי אוטומטי של:
  - סכום
  - מטבע
  - תאריך
  - קטגוריה
  - תיאור

### חילוץ טקסט ממדיניות (`extract-policy-text`)
- קריאת מסמכי מדיניות
- חילוץ כללים

---

## 💱 שער חליפין

### עדכון שערים (`get-exchange-rates`)
- שערי חליפין חיים
- תמיכה ב-50+ מטבעות
- עדכון אוטומטי

---

## 📱 PWA (Progressive Web App)

### התקנה כאפליקציה
- התקנה על מובייל
- עבודה אופליין (חלקית)
- Push notifications

### באנר התקנה
- הצעה להתקנה
- הוראות לפי מכשיר

---

## 📊 אנליטיקות והשוואות

### כרטיס השוואת תקציב
- השוואה בין הוצאות בפועל לתקציב
- התראות על חריגות

### ניתוח הוצאות (`/analytics`)
- גרפים ותרשימים
- ניתוח לפי:
  - קטגוריה
  - זמן
  - עובד
  - מחלקה

---

## 🛠️ מודול Admin (מערכת)

### דשבורד (`/admin`)
- סקירת כל המערכת

### ניהול תפקידים (`/admin/roles`)
- יצירת תפקידים חדשים
- הגדרת הרשאות

### ניהול משתמשים (`/admin/manage-users`)
- כל המשתמשים במערכת
- שינוי תפקידים

### ניהול ארגונים (`/admin/organizations`)
- יצירת ארגונים
- עריכת פרטים

### דשבורד ארגון (`/admin/org-dashboard`)
- צפייה בארגון ספציפי

---

## 🧩 רכיבים משותפים

### StatusBadge
- תצוגת סטטוס צבעונית

### PasswordStrengthIndicator
- בדיקת חוזק סיסמה

### NavLink
- ניווט עם מצב פעיל

### NotificationBell
- פעמון התראות

### InstallBanner
- באנר התקנת PWA

### AppErrorBoundary
- תפיסת שגיאות UI

### RequireAuth
- הגנה על דפים

---

## 🗄️ מבנה בסיס הנתונים

### טבלאות עיקריות:
- `profiles` - פרופילי משתמשים
- `reports` - דוחות הוצאות
- `expenses` - הוצאות בודדות
- `receipts` - קבלות
- `travel_requests` - בקשות נסיעה
- `travel_request_approvals` - אישורי נסיעה
- `travel_policy_rules` - כללי מדיניות
- `travel_policy_restrictions` - הגבלות
- `employee_grades` - דרגות עובדים
- `approval_chain_configs` - הגדרות שרשרת אישורים
- `approval_chain_levels` - רמות אישור
- `organizations` - ארגונים
- `invitation_codes` - קודי הזמנה
- `notifications` - התראות
- `custom_travel_rules` - כללים מותאמים
- `receipt_analysis_logs` - לוגים של ניתוח AI

---

## 🔒 אבטחה

### Row Level Security (RLS)
- הגבלת גישה לנתונים
- כל משתמש רואה רק את הנתונים שלו

### הרשאות לפי תפקיד
- פונקציית `has_role` לבדיקת הרשאות

### הגנה על Routes
- RequireAuth component
- הפניה ל-login אם לא מחובר

---

## 📤 ייצוא נתונים

### ייצוא ל-PDF
- דוחות הוצאות
- מדיניות נסיעות

### שליחה במייל
- דוחות להנהלת חשבונות
- דוחות למנהלים

---

## 🌐 תמיכה בשפות

### עברית (RTL)
- ממשק מלא בעברית
- תמיכה ב-RTL

---

## 📅 פורמטים

### תאריכים
- תמיכה בפורמט ישראלי
- שימוש ב-date-fns

### מטבעות
- 50+ מטבעות נתמכים
- סמלים והמרות

---

## 🎨 עיצוב

### Tailwind CSS
- עיצוב רספונסיבי
- תמיכה במצב כהה

### Shadcn/UI
- קומפוננטות UI מודרניות
- נגישות

### אנימציות
- framer-motion תמיכה
- מעברים חלקים

---

## 📱 תמיכה במובייל

### רספונסיביות מלאה
- כל הדפים מותאמים למובייל
- ניווט מותאם

### מצלמה
- צילום קבלות ישירות מהאפליקציה

### PWA
- התקנה כאפליקציה
- עבודה אופליין חלקית

---

*מסמך זה נוצר אוטומטית ומכיל את כל הפיצ'רים העיקריים במערכת.*
*עודכן לאחרונה: ינואר 2026*
