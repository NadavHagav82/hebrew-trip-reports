# ğŸ“š ×ª×™×¢×•×“ ×˜×›× ×™ ××œ× - ××¢×¨×›×ª × ×™×”×•×œ ×”×•×¦××•×ª ×•× ×¡×™×¢×•×ª ×¢×¡×§×™×•×ª

## ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×
1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [××¨×›×™×˜×§×˜×•×¨×”](#××¨×›×™×˜×§×˜×•×¨×”)
3. [××‘× ×” ×”×¤×¨×•×™×§×˜](#××‘× ×”-×”×¤×¨×•×™×§×˜)
4. [×˜×›× ×•×œ×•×’×™×•×ª](#×˜×›× ×•×œ×•×’×™×•×ª)
5. [××¡×“ ×”× ×ª×•× ×™×](#××¡×“-×”× ×ª×•× ×™×)
6. [Edge Functions](#edge-functions)
7. [××‘×˜×—×”](#××‘×˜×—×”)
8. [×§×•××¤×•× × ×˜×•×ª UI](#×§×•××¤×•× × ×˜×•×ª-ui)
9. [×“×¤×™× ×•× ×™×ª×•×‘](#×“×¤×™×-×•× ×™×ª×•×‘)
10. [Hooks ××•×ª×××™×](#hooks-××•×ª×××™×)
11. [Context](#context)
12. [Utilities](#utilities)

---

## ğŸŒ ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª ××§×™×¤×” ×œ× ×™×”×•×œ ×”×•×¦××•×ª × ×¡×™×¢×•×ª ×¢×¡×§×™×•×ª ×”×›×•×œ×œ×ª:
- × ×™×”×•×œ ×“×•×—×•×ª ×”×•×¦××•×ª ×¢× ×–×™×”×•×™ ×§×‘×œ×•×ª ×—×›× (AI)
- ××™×©×•×¨ ×‘×§×©×•×ª × ×¡×™×¢×” ×¢× ×©×¨×©×¨×ª ××™×©×•×¨×™× ××•×ª×××ª
- ××¢×§×‘ ×ª×§×¦×™×‘×™× ×•××“×™× ×™×•×ª × ×¡×™×¢×•×ª
- × ×™×”×•×œ ××¨×’×•× ×™× ××¨×•×‘×™×
- ××¢×¨×›×ª ×”×ª×¨××•×ª ×‘×–××Ÿ ×××ª
- ×ª××™×›×” ×‘-50+ ××˜×‘×¢×•×ª ×¢× ×©×¢×¨×™ ×—×œ×™×¤×™×Ÿ ×—×™×™×

### ×›×ª×•×‘×•×ª
- **Preview**: https://id-preview--cbf206ae-1e12-4d52-975f-ab71d613283f.lovable.app
- **Production**: https://hebrew-trip-reports.lovable.app

---

## ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React + Vite)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    Pages    â”‚ â”‚ Components  â”‚ â”‚   Hooks     â”‚ â”‚  Contexts   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚               â”‚               â”‚               â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                 â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚   Supabase Client SDK   â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Lovable Cloud        â”‚
                    â”‚       (Supabase)          â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   Authentication    â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚   PostgreSQL DB     â”‚  â”‚
                    â”‚  â”‚   (32+ Tables)      â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚   Edge Functions    â”‚  â”‚
                    â”‚  â”‚   (19 Functions)    â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚      Storage        â”‚  â”‚
                    â”‚  â”‚   (3 Buckets)       â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    External Services      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   Resend (Email)    â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚  Lovable AI Gateway â”‚  â”‚
                    â”‚  â”‚  (Receipt Analysis) â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚ Bank of Israel API  â”‚  â”‚
                    â”‚  â”‚ (Exchange Rates)    â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ××‘× ×” ×”×¤×¨×•×™×§×˜

```
project/
â”œâ”€â”€ public/                          # ×§×‘×¦×™× ×¡×˜×˜×™×™×
â”‚   â”œâ”€â”€ apple-touch-icon.png
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ pwa-192x192.png
â”‚   â”œâ”€â”€ pwa-512x512.png
â”‚   â”œâ”€â”€ placeholder.svg
â”‚   â””â”€â”€ robots.txt
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/                  # ×§×•××¤×•× × ×˜×•×ª
â”‚   â”‚   â”œâ”€â”€ ui/                      # Shadcn UI Components (40+)
â”‚   â”‚   â”‚   â”œâ”€â”€ accordion.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ alert-dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ... (35+ more)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ policy/                  # Policy Management Components
â”‚   â”‚   â”‚   â”œâ”€â”€ ApprovalChainManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryRulesManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CustomRulesManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EmployeeGradesManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ FilterBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PolicyAuditLog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PolicyDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PolicyImportDialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PolicyPreview.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RestrictionsManager.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AccountingComments.tsx   # ×ª×’×•×‘×•×ª ×”× ×”"×—
â”‚   â”‚   â”œâ”€â”€ AccountingSendHistory.tsx # ×”×™×¡×˜×•×¨×™×™×ª ×©×œ×™×—×•×ª
â”‚   â”‚   â”œâ”€â”€ AddExpenseByAccounting.tsx # ×”×•×¡×¤×ª ×”×•×¦××” ×¢"×™ ×”× ×”"×—
â”‚   â”‚   â”œâ”€â”€ AppErrorBoundary.tsx     # Error Boundary
â”‚   â”‚   â”œâ”€â”€ BudgetComparisonCard.tsx # ×”×©×•×•××ª ×ª×§×¦×™×‘
â”‚   â”‚   â”œâ”€â”€ DuplicateExpenseDetector.tsx # ×–×™×”×•×™ ×›×¤×™×œ×•×™×•×ª
â”‚   â”‚   â”œâ”€â”€ ExpenseTemplatesManager.tsx # × ×™×”×•×œ ×ª×‘× ×™×•×ª
â”‚   â”‚   â”œâ”€â”€ InstallBanner.tsx        # ×‘×× ×¨ ×”×ª×§× ×ª PWA
â”‚   â”‚   â”œâ”€â”€ ManagerAttachmentUpload.tsx # ×”×¢×œ××ª ×§×‘×¦×™×
â”‚   â”‚   â”œâ”€â”€ ManagerExpenseReview.tsx # ×¡×§×™×¨×ª ×”×•×¦××•×ª
â”‚   â”‚   â”œâ”€â”€ NavLink.tsx              # ×§×™×©×•×¨ × ×™×•×•×˜
â”‚   â”‚   â”œâ”€â”€ NotificationBell.tsx     # ×¤×¢××•×Ÿ ×”×ª×¨××•×ª
â”‚   â”‚   â”œâ”€â”€ PasswordStrengthIndicator.tsx # ×—×•×–×§ ×¡×™×¡××”
â”‚   â”‚   â”œâ”€â”€ ReportHistory.tsx        # ×”×™×¡×˜×•×¨×™×™×ª ×“×•×—
â”‚   â”‚   â”œâ”€â”€ RequireAuth.tsx          # ×”×’× ×ª ×“×¤×™×
â”‚   â”‚   â”œâ”€â”€ SendToAccountingDialog.tsx # ×©×œ×™×—×” ×œ×”× ×”"×—
â”‚   â”‚   â”œâ”€â”€ StatusBadge.tsx          # ×ª×’ ×¡×˜×˜×•×¡
â”‚   â”‚   â””â”€â”€ TravelRequestAttachments.tsx # ×§×‘×¦×™× ××¦×•×¨×¤×™×
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx          # Context ××™××•×ª
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-mobile.tsx           # ×–×™×”×•×™ ××•×‘×™×™×œ
â”‚   â”‚   â”œâ”€â”€ use-toast.ts             # Toast notifications
â”‚   â”‚   â”œâ”€â”€ usePolicyAuditLog.ts     # ×œ×•×’ ××“×™× ×™×•×ª
â”‚   â”‚   â””â”€â”€ useScrollAnimation.ts    # ×× ×™××¦×™×•×ª ×’×œ×™×œ×”
â”‚   â”‚
â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚   â””â”€â”€ supabase/
â”‚   â”‚       â”œâ”€â”€ client.ts            # Supabase Client (auto-generated)
â”‚   â”‚       â””â”€â”€ types.ts             # TypeScript Types (auto-generated)
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ utils.ts                 # Utility functions
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                       # ×“×¤×™×
â”‚   â”‚   â”œâ”€â”€ auth/                    # ××™××•×ª (7 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ForgotPassword.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ResetPassword.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterSelection.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterEmployee.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterBootstrap.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterIndependent.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RegisterWithCode.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ accounting/              # ×”× ×”×œ×ª ×—×©×‘×•× ×•×ª (8 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountingHome.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountingDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountingStats.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AIAccuracyAnalytics.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BootstrapTokenManagement.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ExpenseTemplates.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManageUsers.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrganizationalAnalytics.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ReimbursementSummary.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/                   # ××“××™×Ÿ (6 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseDiagram.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManageOrganizations.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManageRoles.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManageUsersRoles.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrgAdminUsers.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OrganizationDashboard.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ analytics/               # ×× ×œ×™×˜×™×§×•×ª
â”‚   â”‚   â”‚   â””â”€â”€ ExpenseAnalytics.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manager/                 # ×× ×”×œ (6 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ ManagerDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManagerStats.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManagerPersonalStats.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ManagerTravelStats.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MyTeam.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AdvancedReports.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ orgadmin/                # ×× ×”×œ ××¨×’×•×Ÿ (5 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ OrgAdminDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ InvitationCodesManagement.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrgUsersManagement.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrgAnalytics.tsx
â”‚   â”‚   â”‚   â””â”€â”€ TravelPolicyBuilder.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ policy/                  # ××“×™× ×™×•×ª
â”‚   â”‚   â”‚   â””â”€â”€ MyTravelPolicy.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ reports/                 # ×“×•×—×•×ª (2 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ NewReport.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ViewReport.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ travel/                  # × ×¡×™×¢×•×ª (6 ×“×¤×™×)
â”‚   â”‚   â”‚   â”œâ”€â”€ TravelRequestsList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ NewTravelRequest.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TravelRequestDetails.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PendingTravelApprovals.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ApprovedTravels.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MyApprovalHistory.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AboutSystem.tsx          # ××•×“×•×ª
â”‚   â”‚   â”œâ”€â”€ ApproveReport.tsx        # ××™×©×•×¨ ×“×•×—
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx            # ×“×©×‘×•×¨×“ ×¨××©×™
â”‚   â”‚   â”œâ”€â”€ InstallApp.tsx           # ×”×ª×§× ×ª ××¤×œ×™×§×¦×™×”
â”‚   â”‚   â””â”€â”€ NotFound.tsx             # 404
â”‚   â”‚
â”‚   â”œâ”€â”€ pdf/
â”‚   â”‚   â””â”€â”€ ReportPdf.tsx            # ×™×¦×™×¨×ª PDF
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ imageDataUrl.ts          # ×”××¨×ª ×ª××•× ×•×ª
â”‚   â”‚   â””â”€â”€ pdfToImage.ts            # ×”××¨×ª PDF
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                      # ××¤×œ×™×§×¦×™×” ×¨××©×™×ª
â”‚   â”œâ”€â”€ App.css                      # ×¡×’× ×•× ×•×ª
â”‚   â”œâ”€â”€ index.css                    # Tailwind CSS
â”‚   â”œâ”€â”€ main.tsx                     # Entry point
â”‚   â””â”€â”€ vite-env.d.ts                # Type declarations
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml                  # Supabase config
â”‚   â””â”€â”€ functions/                   # Edge Functions (19)
â”‚       â”œâ”€â”€ analyze-receipt/         # × ×™×ª×•×— ×§×‘×œ×•×ª AI
â”‚       â”œâ”€â”€ approve-report/          # ××™×©×•×¨ ×“×•×—
â”‚       â”œâ”€â”€ bootstrap-token/         # ×˜×•×§×Ÿ ×”×§××”
â”‚       â”œâ”€â”€ create-user/             # ×™×¦×™×¨×ª ××©×ª××©
â”‚       â”œâ”€â”€ extract-policy-text/     # ×—×™×œ×•×¥ ××“×™× ×™×•×ª
â”‚       â”œâ”€â”€ get-exchange-rates/      # ×©×¢×¨×™ ×—×œ×™×¤×™×Ÿ
â”‚       â”œâ”€â”€ notify-accounting-comment/
â”‚       â”œâ”€â”€ notify-approval-skipped/
â”‚       â”œâ”€â”€ notify-employee-review/
â”‚       â”œâ”€â”€ notify-manager-new-employee/
â”‚       â”œâ”€â”€ notify-missing-grades/
â”‚       â”œâ”€â”€ notify-travel-decision/
â”‚       â”œâ”€â”€ notify-travel-request/
â”‚       â”œâ”€â”€ request-add-employee/
â”‚       â”œâ”€â”€ request-report-approval/
â”‚       â”œâ”€â”€ reset-user-password/
â”‚       â”œâ”€â”€ send-accounting-report/
â”‚       â”œâ”€â”€ send-invitation-email/
â”‚       â””â”€â”€ send-report-email/
â”‚
â”œâ”€â”€ BACKEND_DOCUMENTATION.md         # ×ª×™×¢×•×“ Backend
â”œâ”€â”€ SYSTEM_FEATURES_DOCUMENT.md      # ××¡××š ×¤×™×¦'×¨×™×
â”œâ”€â”€ USER_GUIDE.md                    # ××“×¨×™×š ×œ××©×ª××©
â”œâ”€â”€ README.md                        # Readme
â”œâ”€â”€ index.html                       # HTML
â”œâ”€â”€ vite.config.ts                   # Vite config
â”œâ”€â”€ tailwind.config.ts               # Tailwind config
â”œâ”€â”€ tsconfig.json                    # TypeScript config
â”œâ”€â”€ eslint.config.js                 # ESLint config
â””â”€â”€ package.json                     # Dependencies
```

---

## ğŸ› ï¸ ×˜×›× ×•×œ×•×’×™×•×ª

### Frontend
| ×˜×›× ×•×œ×•×’×™×” | ×’×¨×¡×” | ×ª×™××•×¨ |
|-----------|-------|--------|
| React | ^18.3.1 | UI Framework |
| Vite | Latest | Build Tool |
| TypeScript | Latest | Type Safety |
| Tailwind CSS | Latest | Styling |
| Shadcn/UI | Latest | Component Library |
| React Router | ^6.30.1 | Routing |
| TanStack Query | ^5.83.0 | Data Fetching |
| React Hook Form | ^7.61.1 | Form Management |
| Zod | ^3.25.76 | Validation |
| Recharts | ^2.15.4 | Charts |
| Lucide React | ^0.462.0 | Icons |
| date-fns | ^3.6.0 | Date utilities |

### Backend
| ×˜×›× ×•×œ×•×’×™×” | ×ª×™××•×¨ |
|-----------|--------|
| Lovable Cloud (Supabase) | Backend as a Service |
| PostgreSQL | Database |
| Edge Functions (Deno) | Serverless Functions |
| Supabase Auth | Authentication |
| Supabase Storage | File Storage |
| Supabase Realtime | Real-time subscriptions |

### External APIs
| ×©×™×¨×•×ª | ×©×™××•×© |
|--------|--------|
| Resend | Email sending |
| Lovable AI Gateway | Receipt analysis |
| Bank of Israel API | Exchange rates |

### Dependencies ××œ××•×ª
```json
{
  "@hookform/resolvers": "^3.10.0",
  "@radix-ui/react-*": "Multiple UI primitives",
  "@react-pdf/renderer": "^4.3.1",
  "@supabase/supabase-js": "^2.83.0",
  "@tanstack/react-query": "^5.83.0",
  "buffer": "^6.0.3",
  "class-variance-authority": "^0.7.1",
  "clsx": "^2.1.1",
  "cmdk": "^1.1.1",
  "date-fns": "^3.6.0",
  "embla-carousel-react": "^8.6.0",
  "file-saver": "^2.0.5",
  "html2canvas": "^1.4.1",
  "input-otp": "^1.4.2",
  "jspdf-autotable": "^5.0.2",
  "lucide-react": "^0.462.0",
  "mammoth": "^1.11.0",
  "next-themes": "^0.3.0",
  "pdfjs-dist": "^5.4.394",
  "react": "^18.3.1",
  "react-day-picker": "^8.10.1",
  "react-dom": "^18.3.1",
  "react-hook-form": "^7.61.1",
  "react-resizable-panels": "^2.1.9",
  "react-router-dom": "^6.30.1",
  "recharts": "^2.15.4",
  "sonner": "^1.7.4",
  "tailwind-merge": "^2.6.0",
  "tailwindcss-animate": "^1.0.7",
  "vaul": "^0.9.9",
  "vite-plugin-pwa": "^1.2.0",
  "xlsx": "^0.18.5",
  "zod": "^3.25.76"
}
```

---

## ğŸ’¾ ××¡×“ ×”× ×ª×•× ×™×

### ×¡×›××” ××œ××” - 32+ ×˜×‘×œ××•×ª

#### 1. `profiles` - ×¤×¨×•×¤×™×œ×™ ××©×ª××©×™×
```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users,
  username TEXT NOT NULL,
  email TEXT,
  full_name TEXT NOT NULL,
  employee_id TEXT,
  department TEXT NOT NULL,
  is_manager BOOLEAN DEFAULT FALSE,
  manager_id UUID REFERENCES profiles(id),
  organization_id UUID REFERENCES organizations(id),
  grade_id UUID REFERENCES employee_grades(id),
  accounting_manager_email TEXT,
  role app_role,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 2. `user_roles` - ×ª×¤×§×™×“×™ ××©×ª××©×™×
```sql
CREATE TABLE user_roles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  role app_role NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: app_role
-- 'admin', 'manager', 'user', 'accounting_manager', 'org_admin'
```

#### 3. `organizations` - ××¨×’×•× ×™×
```sql
CREATE TABLE organizations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  accounting_type TEXT, -- 'internal' | 'external'
  external_accounting_email TEXT,
  external_accounting_name TEXT,
  created_by UUID,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 4. `reports` - ×“×•×—×•×ª ×”×•×¦××•×ª
```sql
CREATE TABLE reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  trip_destination TEXT NOT NULL,
  trip_purpose TEXT NOT NULL,
  trip_start_date DATE NOT NULL,
  trip_end_date DATE NOT NULL,
  status expense_status DEFAULT 'open',
  total_amount_ils NUMERIC,
  daily_allowance NUMERIC,
  allowance_days INTEGER,
  notes TEXT,
  manager_approval_token TEXT,
  manager_general_comment TEXT,
  rejection_reason TEXT,
  submitted_at TIMESTAMPTZ,
  approved_at TIMESTAMPTZ,
  approved_by UUID REFERENCES profiles(id),
  manager_approval_requested_at TIMESTAMPTZ,
  reimbursement_paid BOOLEAN DEFAULT FALSE,
  reimbursement_paid_at TIMESTAMPTZ,
  reimbursement_paid_by UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: expense_status
-- 'open', 'pending_approval', 'closed'
```

#### 5. `expenses` - ×”×•×¦××•×ª
```sql
CREATE TABLE expenses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID NOT NULL REFERENCES reports(id) ON DELETE CASCADE,
  expense_date DATE NOT NULL,
  category expense_category NOT NULL,
  description TEXT NOT NULL,
  amount NUMERIC NOT NULL,
  currency expense_currency NOT NULL,
  amount_in_ils NUMERIC NOT NULL,
  payment_method payment_method DEFAULT 'out_of_pocket',
  notes TEXT,
  approval_status expense_approval_status DEFAULT 'pending',
  manager_comment TEXT,
  employee_reply TEXT,
  employee_reply_at TIMESTAMPTZ,
  reviewed_by UUID REFERENCES profiles(id),
  reviewed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: expense_category
-- 'flights', 'accommodation', 'food', 'transportation', 'miscellaneous'

-- ENUM: expense_currency (50+ currencies)
-- 'USD', 'EUR', 'ILS', 'GBP', 'CHF', 'JPY', 'CNY', etc.

-- ENUM: payment_method
-- 'out_of_pocket', 'company_card', 'bank_transfer'

-- ENUM: expense_approval_status
-- 'pending', 'approved', 'rejected'
```

#### 6. `receipts` - ×§×‘×œ×•×ª
```sql
CREATE TABLE receipts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  expense_id UUID NOT NULL REFERENCES expenses(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  file_type file_type_enum NOT NULL,
  file_url TEXT NOT NULL,
  file_size INTEGER NOT NULL,
  uploaded_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 7. `travel_requests` - ×‘×§×©×•×ª × ×¡×™×¢×”
```sql
CREATE TABLE travel_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  requested_by UUID NOT NULL,
  destination_city TEXT NOT NULL,
  destination_country TEXT NOT NULL,
  purpose TEXT NOT NULL,
  purpose_details TEXT,
  start_date DATE NOT NULL,
  end_date DATE NOT NULL,
  nights INTEGER,
  days INTEGER,
  estimated_flights NUMERIC,
  estimated_flights_currency expense_currency,
  estimated_accommodation_per_night NUMERIC,
  estimated_accommodation_currency expense_currency,
  estimated_meals_per_day NUMERIC,
  estimated_meals_currency expense_currency,
  estimated_transport NUMERIC,
  estimated_transport_currency expense_currency,
  estimated_other NUMERIC,
  estimated_other_currency expense_currency,
  estimated_total_ils NUMERIC,
  status travel_request_status DEFAULT 'draft',
  current_approval_level INTEGER,
  approved_flights NUMERIC,
  approved_accommodation_per_night NUMERIC,
  approved_meals_per_day NUMERIC,
  approved_transport NUMERIC,
  approved_other NUMERIC,
  approved_total_ils NUMERIC,
  employee_notes TEXT,
  submitted_at TIMESTAMPTZ,
  final_decision_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: travel_request_status
-- 'draft', 'pending_approval', 'approved', 'partially_approved', 'rejected', 'cancelled'
```

#### 8. `travel_request_approvals` - ××™×©×•×¨×™ ×‘×§×©×•×ª × ×¡×™×¢×”
```sql
CREATE TABLE travel_request_approvals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  travel_request_id UUID NOT NULL REFERENCES travel_requests(id),
  approver_id UUID NOT NULL,
  approval_level INTEGER DEFAULT 1,
  status approval_status DEFAULT 'pending',
  comments TEXT,
  approved_flights NUMERIC,
  approved_accommodation_per_night NUMERIC,
  approved_meals_per_day NUMERIC,
  approved_transport NUMERIC,
  approved_other NUMERIC,
  decided_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: approval_status
-- 'pending', 'approved', 'rejected', 'skipped'
```

#### 9. `travel_request_violations` - ×—×¨×™×’×•×ª ××“×™× ×™×•×ª
```sql
CREATE TABLE travel_request_violations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  travel_request_id UUID NOT NULL REFERENCES travel_requests(id),
  category expense_category NOT NULL,
  requested_amount NUMERIC NOT NULL,
  policy_limit NUMERIC NOT NULL,
  overage_amount NUMERIC NOT NULL,
  overage_percentage NUMERIC NOT NULL,
  employee_explanation TEXT,
  requires_special_approval BOOLEAN DEFAULT FALSE,
  is_resolved BOOLEAN DEFAULT FALSE,
  resolved_by UUID,
  resolved_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 10. `approved_travels` - × ×¡×™×¢×•×ª ×××•×©×¨×•×ª
```sql
CREATE TABLE approved_travels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  travel_request_id UUID NOT NULL UNIQUE REFERENCES travel_requests(id),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  approval_number TEXT NOT NULL, -- e.g., 'TR-2024-0001'
  approved_budget JSONB DEFAULT '{}',
  valid_from DATE NOT NULL,
  valid_until DATE NOT NULL,
  expense_report_id UUID REFERENCES reports(id),
  is_used BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 11. `travel_request_attachments` - ×§×‘×¦×™× ××¦×•×¨×¤×™×
```sql
CREATE TABLE travel_request_attachments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  travel_request_id UUID NOT NULL REFERENCES travel_requests(id),
  uploaded_by UUID NOT NULL,
  file_name TEXT NOT NULL,
  file_url TEXT NOT NULL,
  file_type TEXT NOT NULL,
  file_size INTEGER NOT NULL,
  category TEXT DEFAULT 'general', -- 'general', 'quote', 'invitation'
  link_url TEXT,
  notes TEXT,
  uploaded_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 12. `employee_grades` - ×“×¨×’×•×ª ×¢×•×‘×“×™×
```sql
CREATE TABLE employee_grades (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  name TEXT NOT NULL,
  level INTEGER NOT NULL, -- 1=lowest, 5=highest
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_by UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 13. `travel_policy_rules` - ×›×œ×œ×™ ××“×™× ×™×•×ª × ×¡×™×¢×•×ª
```sql
CREATE TABLE travel_policy_rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  category expense_category NOT NULL,
  grade_id UUID REFERENCES employee_grades(id), -- NULL = applies to all
  max_amount NUMERIC,
  currency expense_currency DEFAULT 'USD',
  destination_type destination_type DEFAULT 'all',
  destination_countries TEXT[],
  per_type policy_rule_per_type DEFAULT 'per_trip',
  notes TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_by UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: destination_type
-- 'domestic', 'international', 'all'

-- ENUM: policy_rule_per_type
-- 'per_trip', 'per_day', 'per_night'
```

#### 14. `travel_policy_restrictions` - ×”×’×‘×œ×•×ª ××“×™× ×™×•×ª
```sql
CREATE TABLE travel_policy_restrictions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  name TEXT NOT NULL,
  description TEXT,
  category expense_category, -- NULL = all categories
  keywords TEXT[],
  action_type policy_action_type DEFAULT 'warn',
  is_active BOOLEAN DEFAULT TRUE,
  created_by UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: policy_action_type
-- 'block', 'warn', 'require_approval'
```

#### 15. `custom_travel_rules` - ×›×œ×œ×™× ××•×ª×××™×
```sql
CREATE TABLE custom_travel_rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  rule_name TEXT NOT NULL,
  description TEXT,
  condition_json JSONB DEFAULT '{}',
  action_type policy_action_type DEFAULT 'warn',
  applies_to_grades TEXT[],
  priority INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT TRUE,
  created_by UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 16. `approval_chain_configs` - ×”×’×“×¨×•×ª ×©×¨×©×¨×ª ××™×©×•×¨×™×
```sql
CREATE TABLE approval_chain_configs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  name TEXT NOT NULL,
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  is_default BOOLEAN DEFAULT FALSE,
  created_by UUID,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 17. `approval_chain_levels` - ×¨××•×ª ×©×¨×©×¨×ª ××™×©×•×¨×™×
```sql
CREATE TABLE approval_chain_levels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  chain_id UUID NOT NULL REFERENCES approval_chain_configs(id) ON DELETE CASCADE,
  level_order INTEGER NOT NULL,
  level_type approval_level_type NOT NULL,
  specific_user_id UUID,
  is_required BOOLEAN DEFAULT TRUE,
  can_skip_if_approved_amount_under NUMERIC,
  custom_message TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: approval_level_type
-- 'direct_manager', 'org_admin', 'accounting_manager', 'specific_user'
```

#### 18. `grade_chain_assignments` - ×”×§×¦××ª ×©×¨×©×¨××•×ª ×œ×“×¨×’×•×ª
```sql
CREATE TABLE grade_chain_assignments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  grade_id UUID REFERENCES employee_grades(id),
  chain_id UUID NOT NULL REFERENCES approval_chain_configs(id),
  min_amount NUMERIC,
  max_amount NUMERIC,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 19. `invitation_codes` - ×§×•×“×™ ×”×–×× ×”
```sql
CREATE TABLE invitation_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  code TEXT NOT NULL UNIQUE,
  role app_role DEFAULT 'user',
  manager_id UUID REFERENCES profiles(id),
  grade_id UUID REFERENCES employee_grades(id),
  max_uses INTEGER,
  use_count INTEGER DEFAULT 0,
  is_used BOOLEAN DEFAULT FALSE,
  used_by UUID REFERENCES profiles(id),
  used_at TIMESTAMPTZ,
  expires_at TIMESTAMPTZ NOT NULL,
  notes TEXT,
  created_by UUID NOT NULL REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 20. `bootstrap_tokens` - ×˜×•×§× ×™× ×œ×”×§××” ×¨××©×•× ×™×ª
```sql
CREATE TABLE bootstrap_tokens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  token TEXT NOT NULL UNIQUE,
  is_used BOOLEAN DEFAULT FALSE,
  used_by UUID,
  used_at TIMESTAMPTZ,
  expires_at TIMESTAMPTZ NOT NULL,
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 21. `notifications` - ×”×ª×¨××•×ª
```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  type TEXT NOT NULL,
  title TEXT NOT NULL,
  message TEXT NOT NULL,
  is_read BOOLEAN DEFAULT FALSE,
  report_id UUID REFERENCES reports(id),
  travel_request_id UUID REFERENCES travel_requests(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 22. `accounting_comments` - ×ª×’×•×‘×•×ª ×”× ×”×œ×ª ×—×©×‘×•× ×•×ª
```sql
CREATE TABLE accounting_comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID NOT NULL REFERENCES reports(id),
  created_by UUID NOT NULL REFERENCES profiles(id),
  comment_text TEXT NOT NULL,
  is_resolved BOOLEAN DEFAULT FALSE,
  resolved_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 23. `accounting_send_history` - ×”×™×¡×˜×•×¨×™×™×ª ×©×œ×™×—×•×ª ×œ×”× ×”"×—
```sql
CREATE TABLE accounting_send_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID NOT NULL REFERENCES reports(id),
  sent_by UUID NOT NULL,
  sent_to_user_id UUID,
  sent_to_email TEXT NOT NULL,
  sent_to_name TEXT,
  send_method TEXT NOT NULL,
  sent_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 24. `report_history` - ×”×™×¡×˜×•×¨×™×™×ª ×“×•×—×•×ª
```sql
CREATE TABLE report_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID NOT NULL REFERENCES reports(id),
  performed_by UUID NOT NULL REFERENCES profiles(id),
  action report_action NOT NULL,
  notes TEXT,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- ENUM: report_action
-- 'created', 'updated', 'submitted', 'approved', 'rejected', etc.
```

#### 25. `report_comments` - ×ª×’×•×‘×•×ª ×¢×œ ×“×•×—×•×ª
```sql
CREATE TABLE report_comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID NOT NULL REFERENCES reports(id),
  user_id UUID NOT NULL REFERENCES profiles(id),
  comment_text TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 26. `report_preferences` - ×”×¢×“×¤×•×ª ×“×•×—×•×ª
```sql
CREATE TABLE report_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  name TEXT NOT NULL,
  filters JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

#### 27. `expense_templates` - ×ª×‘× ×™×•×ª ×”×•×¦××•×ª
```sql
CREATE TABLE expense_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  created_by UUID NOT NULL REFERENCES profiles(id),
  template_name TEXT NOT NULL,
  description TEXT NOT NULL,
  category expense_category NOT NULL,
  amount NUMERIC,
  currency expense_currency DEFAULT 'ILS',
  country TEXT,
  notes TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 28. `expense_alerts` - ×”×ª×¨××•×ª ×”×•×¦××•×ª
```sql
CREATE TABLE expense_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  alert_type TEXT NOT NULL,
  threshold_amount NUMERIC,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ
);
```

#### 29. `manager_comment_attachments` - ×§×‘×¦×™× ××¦×•×¨×¤×™× ×œ×”×¢×¨×•×ª ×× ×”×œ
```sql
CREATE TABLE manager_comment_attachments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  expense_id UUID NOT NULL REFERENCES expenses(id),
  uploaded_by UUID NOT NULL REFERENCES profiles(id),
  file_name TEXT NOT NULL,
  file_url TEXT NOT NULL,
  file_type TEXT NOT NULL,
  file_size INTEGER NOT NULL,
  uploaded_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 30. `recipient_lists` - ×¨×©×™××•×ª × ××¢× ×™×
```sql
CREATE TABLE recipient_lists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  list_name TEXT NOT NULL,
  recipient_emails TEXT[] NOT NULL,
  is_default BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 31. `policy_audit_log` - ×œ×•×’ ×©×™× ×•×™×™ ××“×™× ×™×•×ª
```sql
CREATE TABLE policy_audit_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  user_id UUID NOT NULL,
  entity_type TEXT NOT NULL,
  entity_id UUID,
  entity_name TEXT,
  action TEXT NOT NULL,
  old_values JSONB,
  new_values JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 32. `receipt_analysis_logs` - ×œ×•×’×™× ×©×œ × ×™×ª×•×— ×§×‘×œ×•×ª AI
```sql
CREATE TABLE receipt_analysis_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,
  report_id UUID REFERENCES reports(id),
  expense_id UUID REFERENCES expenses(id),
  image_file_name TEXT,
  image_file_size INTEGER,
  extracted_amount NUMERIC,
  extracted_currency TEXT,
  extracted_date TEXT,
  extracted_description TEXT,
  extracted_category TEXT,
  user_corrected_amount NUMERIC,
  user_corrected_currency TEXT,
  user_corrected_date TEXT,
  user_swapped_day_month BOOLEAN,
  raw_ai_response JSONB,
  device_info TEXT,
  trip_destination TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Database Views

#### `profiles_limited` - ×ª×¦×•×’×” ××•×’×‘×œ×ª ×©×œ ×¤×¨×•×¤×™×œ×™×
```sql
CREATE VIEW profiles_limited AS
SELECT 
  id,
  full_name,
  username,
  department,
  is_manager,
  manager_id,
  organization_id
FROM profiles;
```

### Database Functions

```sql
-- ×‘×“×™×§×ª ×ª×¤×§×™×“
CREATE FUNCTION has_role(_role app_role, _user_id uuid) RETURNS boolean;

-- ×‘×“×™×§×” ×× ×× ×”×œ ×©×œ ××©×ª××©
CREATE FUNCTION is_manager_of(target_user_id uuid) RETURNS boolean;

-- ×§×‘×œ×ª ××–×”×” ××¨×’×•×Ÿ
CREATE FUNCTION get_user_organization_id(_user_id uuid) RETURNS uuid;

-- ×§×‘×œ×ª ××–×”×” ×× ×”×œ
CREATE FUNCTION get_user_manager_id(_user_id uuid) RETURNS uuid;

-- ×§×‘×œ×ª ×¢×•×‘×“×™ ×¦×•×•×ª
CREATE FUNCTION get_team_user_ids(_manager_id uuid) RETURNS uuid[];

-- ×™×¦×™×¨×ª ××¡×¤×¨ ××™×©×•×¨ × ×¡×™×¢×”
CREATE FUNCTION generate_travel_approval_number() RETURNS text;

-- ×‘×“×™×§×” ×× ×××©×¨ ×‘×§×©×ª × ×¡×™×¢×”
CREATE FUNCTION is_travel_request_approver(_travel_request_id uuid, _user_id uuid) RETURNS boolean;

-- ×‘×“×™×§×” ×× ××•×ª×• ××¨×’×•×Ÿ
CREATE FUNCTION same_organization(_a uuid, _b uuid) RETURNS boolean;

-- ×‘×“×™×§×” ×× ×§×™×™× ×× ×”×œ ×—×©×‘×•× ×•×ª
CREATE FUNCTION accounting_manager_exists() RETURNS boolean;
```

### Storage Buckets

| Bucket | ×ª×™××•×¨ | ×’×™×©×” |
|--------|--------|------|
| `receipts` | ×§×‘×œ×•×ª | Private |
| `manager-attachments` | ×§×‘×¦×™× ×× ×”×œ | Private |
| `travel-attachments` | ×§×‘×¦×™ ×‘×§×©×•×ª × ×¡×™×¢×” | Private |

---

## âš¡ Edge Functions

### 1. `analyze-receipt` - × ×™×ª×•×— ×§×‘×œ×•×ª AI
```typescript
// ××§×‘×œ: base64 image, tripDestination
// ××—×–×™×¨: { amount, currency, date, category, description }
// ××©×ª××© ×‘-Lovable AI Gateway
```

### 2. `approve-report` - ××™×©×•×¨ ×“×•×—
```typescript
// ××§×‘×œ: token, action ('approve'|'reject'), comments
// ××¢×“×›×Ÿ ×¡×˜×˜×•×¡ ×“×•×—
// ×©×•×œ×— ×”×ª×¨××•×ª
```

### 3. `bootstrap-token` - ×™×¦×™×¨×ª ×˜×•×§×Ÿ ×”×§××”
```typescript
// ××§×‘×œ: notes, expiresIn
// ××—×–×™×¨: token string
```

### 4. `create-user` - ×™×¦×™×¨×ª ××©×ª××©
```typescript
// ××§×‘×œ: email, fullName, department, role, managerId
// ×™×•×¦×¨ ××©×ª××© ×‘-auth + profile
// ×©×•×œ×— ××™×™×œ ×¢× ×¡×™×¡××” ×–×× ×™×ª
// ×“×•×¨×©: accounting_manager role
```

### 5. `extract-policy-text` - ×—×™×œ×•×¥ ××“×™× ×™×•×ª ××ª××•× ×”
```typescript
// ××§×‘×œ: imageBase64, fileType
// ××—×–×™×¨: ××¢×¨×š ×›×œ×œ×™ ××“×™× ×™×•×ª
// ××©×ª××© ×‘-Lovable AI Gateway
```

### 6. `get-exchange-rates` - ×©×¢×¨×™ ×—×œ×™×¤×™×Ÿ
```typescript
// ××§×‘×œ: (×œ×œ× ×¤×¨××˜×¨×™×)
// ××—×–×™×¨: { rates: { USD: number, EUR: number, ... } }
// ××§×•×¨: Bank of Israel API
// fallback: ×©×¢×¨×™× ×§×‘×•×¢×™×
```

### 7. `notify-accounting-comment` - ×”×ª×¨××” ×¢×œ ×ª×’×•×‘×ª ×”× ×”"×—
```typescript
// ××§×‘×œ: reportId, commentText, commentAuthor
// ×©×•×œ×— ××™×™×œ ×œ×¢×•×‘×“ ×•×œ×× ×”×œ
```

### 8. `notify-approval-skipped` - ×”×ª×¨××” ×¢×œ ×“×™×œ×•×’ ××™×©×•×¨
```typescript
// ××§×‘×œ: travelRequestId, skippedLevel, reason
// ×©×•×œ×— ××™×™×œ ×œ××’×™×© ×”×‘×§×©×”
```

### 9. `notify-employee-review` - ×”×ª×¨××” ×œ×¢×•×‘×“ ×¢×œ ×¡×§×™×¨×”
```typescript
// ××§×‘×œ: reportId, reviewType
// ×©×•×œ×— ××™×™×œ ×œ×¢×•×‘×“
```

### 10. `notify-manager-new-employee` - ×”×ª×¨××” ×¢×œ ×¢×•×‘×“ ×—×“×©
```typescript
// ××§×‘×œ: employeeName, employeeEmail, managerId
// ×©×•×œ×— ××™×™×œ ×œ×× ×”×œ
```

### 11. `notify-missing-grades` - ×”×ª×¨××” ×¢×œ ×“×¨×’×•×ª ×—×¡×¨×•×ª
```typescript
// ××§×‘×œ: organizationId, userIds
// ×©×•×œ×— ××™×™×œ ×œ×× ×”×œ ××¨×’×•×Ÿ
```

### 12. `notify-travel-decision` - ×”×ª×¨××” ×¢×œ ×”×—×œ×˜×” ×‘× ×¡×™×¢×”
```typescript
// ××§×‘×œ: travelRequestId, decision, comments
// ×©×•×œ×— ××™×™×œ ×œ××’×™×© ×”×‘×§×©×”
```

### 13. `notify-travel-request` - ×”×ª×¨××” ×¢×œ ×‘×§×©×ª × ×¡×™×¢×” ×—×“×©×”
```typescript
// ××§×‘×œ: travelRequestId, approverId
// ×©×•×œ×— ××™×™×œ ×œ×××©×¨
```

### 14. `request-add-employee` - ×‘×§×©×” ×œ×”×•×¡×¤×ª ×¢×•×‘×“
```typescript
// ××§×‘×œ: managerName, managerEmail, employeeDetails, notes
// ×©×•×œ×— ××™×™×œ ×œ×× ×”×œ ×—×©×‘×•× ×•×ª
```

### 15. `request-report-approval` - ×‘×§×©×ª ××™×©×•×¨ ×“×•×—
```typescript
// ××§×‘×œ: reportId, managerId
// ×™×•×¦×¨ ×˜×•×§×Ÿ ××™×©×•×¨
// ×©×•×œ×— ××™×™×œ ×œ×× ×”×œ
```

### 16. `reset-user-password` - ××™×¤×•×¡ ×¡×™×¡××”
```typescript
// ××§×‘×œ: user_id
// ×™×•×¦×¨ ×¡×™×¡××” ×—×“×©×”
// ×©×•×œ×— ××™×™×œ ×œ××©×ª××©
// ×“×•×¨×©: accounting_manager role
```

### 17. `send-accounting-report` - ×©×œ×™×—×ª ×“×•×— ×œ×”× ×”"×—
```typescript
// ××§×‘×œ: reportId, recipientEmails, pdfBase64
// ×©×•×œ×— ××™×™×œ ×¢× PDF ××¦×•×¨×£
```

### 18. `send-invitation-email` - ×©×œ×™×—×ª ×”×–×× ×”
```typescript
// ××§×‘×œ: email, invitationCode, organizationName
// ×©×•×œ×— ××™×™×œ ×”×–×× ×” ×œ×”×¨×©××”
```

### 19. `send-report-email` - ×©×œ×™×—×ª ×“×•×—
```typescript
// ××§×‘×œ: recipientEmails, reportId, pdfBase64, reportData
// ×©×•×œ×— ××™×™×œ ×¢× PDF ××¦×•×¨×£
```

---

## ğŸ”’ ××‘×˜×—×”

### Row-Level Security (RLS) Policies

×›×œ ×”×˜×‘×œ××•×ª ××•×’× ×•×ª ×‘-RLS. ×“×•×’×××•×ª:

#### profiles
```sql
-- Users can read own profile
CREATE POLICY "Users can read own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = id);

-- Managers can read team profiles
CREATE POLICY "Managers can read team profiles"
  ON profiles FOR SELECT
  USING (is_manager_of(id));

-- Accounting managers can read all
CREATE POLICY "Accounting managers can read all"
  ON profiles FOR SELECT
  USING (has_role('accounting_manager', auth.uid()));
```

#### reports
```sql
-- Users can CRUD own reports
CREATE POLICY "Users can CRUD own reports"
  ON reports FOR ALL
  USING (auth.uid() = user_id);

-- Managers can read team reports
CREATE POLICY "Managers can read team reports"
  ON reports FOR SELECT
  USING (is_manager_of(user_id));
```

### Authentication Flow
1. ××©×ª××© × ×¨×©×/××ª×—×‘×¨ ×“×¨×š Supabase Auth
2. Trigger ×™×•×¦×¨ ×¨×©×•××” ×‘-profiles
3. ×ª×¤×§×™×“×™× × ×§×‘×¢×™× ×‘-user_roles
4. RLS Policies ××’×‘×™×œ×•×ª ×’×™×©×” ×œ× ×ª×•× ×™×

---

## ğŸ¨ ×§×•××¤×•× × ×˜×•×ª UI

### Shadcn/UI Components (40+)
- Accordion, Alert, AlertDialog
- Avatar, Badge, Breadcrumb
- Button, Calendar, Card
- Carousel, Checkbox, Collapsible
- Command, ContextMenu, Dialog
- Drawer, DropdownMenu, Form
- HoverCard, Input, InputOTP
- Label, Menubar, NavigationMenu
- Pagination, Popover, Progress
- RadioGroup, Resizable, ScrollArea
- Select, Separator, Sheet
- Sidebar, Skeleton, Slider
- Sonner, Switch, Table
- Tabs, Textarea, Toast
- Toggle, ToggleGroup, Tooltip

### Custom Components
| Component | ×ª×™××•×¨ |
|-----------|--------|
| `AccountingComments` | ×ª×’×•×‘×•×ª ×”× ×”×œ×ª ×—×©×‘×•× ×•×ª |
| `BudgetComparisonCard` | ×”×©×•×•××ª ×ª×§×¦×™×‘ |
| `DuplicateExpenseDetector` | ×–×™×”×•×™ ×›×¤×™×œ×•×™×•×ª |
| `ExpenseTemplatesManager` | × ×™×”×•×œ ×ª×‘× ×™×•×ª |
| `InstallBanner` | ×‘×× ×¨ ×”×ª×§× ×ª PWA |
| `ManagerExpenseReview` | ×¡×§×™×¨×ª ×”×•×¦××•×ª |
| `NotificationBell` | ×¤×¢××•×Ÿ ×”×ª×¨××•×ª |
| `PasswordStrengthIndicator` | ××“ ×—×•×–×§ ×¡×™×¡××” |
| `RequireAuth` | ×”×’× ×ª ×“×¤×™× |
| `SendToAccountingDialog` | ×©×œ×™×—×” ×œ×”× ×”"×— |
| `StatusBadge` | ×ª×’ ×¡×˜×˜×•×¡ ×¦×‘×¢×•× ×™ |

### Policy Components
| Component | ×ª×™××•×¨ |
|-----------|--------|
| `ApprovalChainManager` | × ×™×”×•×œ ×©×¨×©×¨××•×ª ××™×©×•×¨ |
| `CategoryRulesManager` | × ×™×”×•×œ ×ª×§×¨×•×ª ×§×˜×’×•×¨×™×•×ª |
| `CustomRulesManager` | ×›×œ×œ×™× ××•×ª×××™× |
| `EmployeeGradesManager` | × ×™×”×•×œ ×“×¨×’×•×ª |
| `PolicyAuditLog` | ×œ×•×’ ×©×™× ×•×™×™× |
| `PolicyDashboard` | ×“×©×‘×•×¨×“ ××“×™× ×™×•×ª |
| `PolicyPreview` | ×ª×¦×•×’×” ××§×“×™××” |
| `RestrictionsManager` | × ×™×”×•×œ ×”×’×‘×œ×•×ª |

---

## ğŸ›¤ï¸ ×“×¤×™× ×•× ×™×ª×•×‘

### Routes ××œ××•×ª

```typescript
// Public
"/"                           // Dashboard
"/about"                      // About system

// Auth
"/auth/login"                 // Login
"/auth/forgot-password"       // Forgot password
"/auth/reset-password"        // Reset password
"/auth/register"              // Register selection
"/auth/register/employee"     // Employee registration
"/auth/register/manager"      // Manager registration
"/auth/register/code"         // Registration with code
"/auth/register/bootstrap"    // Bootstrap registration
"/auth/register/independent"  // Independent registration

// Reports
"/reports/new"                // New report
"/reports/:id"                // View report
"/approve-report/:token"      // Approve report (external)

// Travel
"/travel-requests"            // Travel requests list
"/travel-requests/new"        // New travel request
"/travel-requests/:id"        // View travel request
"/travel-requests/pending"    // Pending approvals
"/approved-travels"           // Approved travels
"/travel/my-approval-history" // My approval history

// Manager
"/manager/dashboard"          // Manager dashboard
"/manager/team"               // My team
"/manager/stats"              // Team stats
"/manager/personal-stats"     // Personal stats
"/manager/travel-stats"       // Travel stats
"/manager/advanced-reports"   // Advanced reports

// Accounting
"/accounting/home"            // Accounting home
"/accounting/dashboard"       // Dashboard
"/accounting/stats"           // Stats
"/accounting/organizational-analytics" // Org analytics
"/accounting/reimbursements"  // Reimbursements
"/accounting/users"           // Manage users
"/accounting/templates"       // Expense templates
"/accounting/ai-analytics"    // AI analytics
"/accounting/bootstrap-tokens" // Bootstrap tokens

// Org Admin
"/orgadmin"                   // Org admin dashboard
"/orgadmin/invitation-codes"  // Invitation codes
"/orgadmin/users"             // Manage users
"/orgadmin/analytics"         // Analytics
"/orgadmin/travel-policy"     // Travel policy builder

// Admin
"/admin"                      // Admin dashboard
"/admin/roles"                // Manage roles
"/admin/manage-users"         // Manage users
"/admin/organizations"        // Manage organizations
"/admin/org-dashboard"        // Organization dashboard
"/admin/database-diagram"     // Database diagram

// Other
"/policy/my-travel-policy"    // My travel policy
"/analytics"                  // Expense analytics
"/install"                    // Install PWA
```

---

## ğŸª Hooks ××•×ª×××™×

```typescript
// use-mobile.tsx
export function useIsMobile(): boolean;

// use-toast.ts
export function useToast(): {
  toast: (options: ToastOptions) => void;
  dismiss: (toastId?: string) => void;
  toasts: Toast[];
};

// usePolicyAuditLog.ts
export function usePolicyAuditLog(organizationId: string): {
  logs: AuditLog[];
  isLoading: boolean;
  logAction: (params: LogActionParams) => Promise<void>;
};

// useScrollAnimation.ts
export function useScrollAnimation(): {
  ref: RefObject<HTMLElement>;
  isVisible: boolean;
};
```

---

## ğŸ”§ Context

### AuthContext

```typescript
interface AuthContextType {
  user: User | null;
  profile: Profile | null;
  roles: AppRole[];
  isLoading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string, metadata: UserMetadata) => Promise<void>;
  signOut: () => Promise<void>;
  hasRole: (role: AppRole) => boolean;
  isManager: boolean;
  isAccountingManager: boolean;
  isOrgAdmin: boolean;
  isAdmin: boolean;
}

// Usage
const { user, profile, hasRole, signOut } = useAuth();
```

---

## ğŸ§° Utilities

### lib/utils.ts
```typescript
// Class name merge
export function cn(...inputs: ClassValue[]): string;
```

### utils/imageDataUrl.ts
```typescript
// Convert image to data URL
export async function imageToDataUrl(file: File): Promise<string>;
```

### utils/pdfToImage.ts
```typescript
// Convert PDF to images
export async function pdfToImages(file: File): Promise<string[]>;
```

---

## ğŸ“§ Secrets (Environment Variables)

| Secret | ×ª×™××•×¨ | ×©×™××•×© |
|--------|--------|-------|
| `SUPABASE_URL` | Supabase URL | Auto-configured |
| `SUPABASE_ANON_KEY` | Supabase Anon Key | Auto-configured |
| `SUPABASE_SERVICE_ROLE_KEY` | Service Role Key | Edge Functions |
| `RESEND_API_KEY` | Resend API Key | Email sending |
| `LOVABLE_API_KEY` | Lovable AI Gateway | AI features |

---

## ğŸ“± PWA Support

×”××¤×œ×™×§×¦×™×” ×ª×•××›×ª ×‘×”×ª×§× ×” ×›-PWA:
- Service Worker
- Manifest
- Offline support (partial)
- Add to home screen
- Push notifications (future)

---

## ğŸ“Š ×¡×™×›×•× ×¡×˜×˜×™×¡×˜×™

| ×§×˜×’×•×¨×™×” | ×›××•×ª |
|---------|------|
| ×˜×‘×œ××•×ª DB | 32+ |
| Edge Functions | 19 |
| ×“×¤×™× | 45+ |
| ×§×•××¤×•× × ×˜×•×ª UI | 40+ |
| ×§×•××¤×•× × ×˜×•×ª ××•×ª×××•×ª | 20+ |
| Hooks | 4 |
| Storage Buckets | 3 |
| ××˜×‘×¢×•×ª × ×ª××›×™× | 50+ |
| ×ª×¤×§×™×“×™ ××©×ª××© | 5 |

---

## ğŸ”„ ×ª××¨×™×š ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ

**18 ×‘×™× ×•××¨ 2026**

---

## ğŸ“ ×”×¢×¨×•×ª × ×•×¡×¤×•×ª

1. **××‘×˜×—×”**: ×›×œ ×”×˜×‘×œ××•×ª ××•×’× ×•×ª ×‘-RLS
2. **×‘×™×¦×•×¢×™×**: ×©×™××•×© ×‘-TanStack Query ×œ×§××©×™× ×’
3. **RTL**: ×ª××™×›×” ××œ××” ×‘×¢×‘×¨×™×ª
4. **Responsive**: ×¢×™×¦×•×‘ ××•×ª×× ×œ×›×œ ×”××¡×›×™×
5. **Accessibility**: ×©×™××•×© ×‘-Radix UI Primitives

---

*××¡××š ×–×” × ×•×¦×¨ ××•×˜×•××˜×™×ª ×•××ª×¢×“ ××ª ×›×œ ×”×§×•×“ ×•×”××¨×›×™×˜×§×˜×•×¨×” ×©×œ ×”××¢×¨×›×ª.*
